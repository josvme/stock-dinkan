# Calculate strongest industries in 5 days (This can be adjusted)
```postgres-sql
WITH FORBIDDENSTOCKS AS
	(SELECT DISTINCT SYMBOL
		FROM DAYVALUES
		WHERE SCLOSE < 3),
	T AS
	(SELECT DAYVALUES.SYMBOL AS SYM, *,
			ROW_NUMBER() OVER (PARTITION BY DAYVALUES.SYMBOL
																						ORDER BY STIME DESC) AS RN,
			LAG(SCLOSE,

				-1,
				SCLOSE) OVER (PARTITION BY DAYVALUES.SYMBOL
																		ORDER BY STIME DESC) AS PREVIOUS_CLOSE
		FROM DAYVALUES
		JOIN FUNDAMENTALS ON DAYVALUES.SYMBOL = FUNDAMENTALS.SYMBOL
		WHERE DAYVALUES.SYMBOL NOT IN
				(SELECT *
					FROM FORBIDDENSTOCKS)),
	TT AS
	(SELECT *
		FROM T
		WHERE T.RN <= 5
			AND T.RN >= 0
		ORDER BY SYM ASC),
	AVG_GAIN_WITH_INDUSTRY AS
	(SELECT AVG((TT.SCLOSE - TT.PREVIOUS_CLOSE) / TT.PREVIOUS_CLOSE) AS AVG_GAIN,
			TT.SYM,
			JSONB_PATH_QUERY(TT.DATA,

				'$.industry') AS INDUSTRY
		FROM TT
		GROUP BY TT.SYM,
			INDUSTRY
		ORDER BY AVG_GAIN DESC),
	FASTEST_INDUSTRY AS
	(SELECT AVG(AVG_GAIN) AS G,
			COUNT(1) AS STOCKS_COUNT,
			INDUSTRY
		FROM AVG_GAIN_WITH_INDUSTRY
		GROUP BY INDUSTRY)
SELECT *
FROM FASTEST_INDUSTRY
ORDER BY G DESC,
	STOCKS_COUNT DESC;
```

# Calculate RS strenth of a stock with itself based on 6 months
```postgres-sql
WITH T AS
	(SELECT DAYVALUES.SYMBOL AS SYM, *,
			ROW_NUMBER() OVER (PARTITION BY DAYVALUES.SYMBOL
																						ORDER BY STIME DESC) AS RN
		FROM DAYVALUES
		JOIN FUNDAMENTALS ON DAYVALUES.SYMBOL = FUNDAMENTALS.SYMBOL),
	TC AS
	(SELECT *
		FROM T
		WHERE T.RN = 1
		ORDER BY SYM ASC),
	TC62 AS
	(SELECT AVG(T.SCLOSE) AS SCLOSE,
			SYM
		FROM T
		WHERE T.RN <= 63
		GROUP BY T.SYM
		ORDER BY SYM ASC),
	TC126 AS
	(SELECT AVG(T.SCLOSE) AS SCLOSE,
			SYM
		FROM T
		WHERE T.RN <= 126
		GROUP BY T.SYM
		ORDER BY SYM ASC),
	RS AS
	(SELECT (2 * TC.SCLOSE / TC62.SCLOSE) + (TC.SCLOSE / TC126.SCLOSE) AS STRENGTH,
			TC.SYM,
			TC.SCLOSE AS SCLOSE_S,
			TC62.SCLOSE AS TC62_S,
			TC126.SCLOSE AS TC126_S
		FROM TC
		JOIN TC62 ON TC.SYM = TC62.SYM
		JOIN TC126 ON TC.SYM = TC126.SYM)
SELECT *
FROM RS
ORDER BY STRENGTH DESC ;
```

## Relative strength rating between 1-100 for all stocks sorted, after getting rid of all cheap less than 3 dollar stocks
```postgres-sql
WITH FORBIDDENSTOCKS AS
	(SELECT DISTINCT SYMBOL
		FROM DAYVALUES
		WHERE SCLOSE < 3),
	T AS
	(SELECT DAYVALUES.SYMBOL AS SYM, *,
			ROW_NUMBER() OVER (PARTITION BY DAYVALUES.SYMBOL
																						ORDER BY STIME DESC) AS RN
		FROM DAYVALUES
		JOIN FUNDAMENTALS ON DAYVALUES.SYMBOL = FUNDAMENTALS.SYMBOL
		WHERE DAYVALUES.SYMBOL NOT IN
				(SELECT *
					FROM FORBIDDENSTOCKS)),
	TC AS
	(SELECT *
		FROM T
		WHERE T.RN = 1
		ORDER BY SYM ASC),
	TC62 AS
	(SELECT AVG(T.SCLOSE) AS SCLOSE,
			SYM
		FROM T
		WHERE T.RN <= 63
		GROUP BY T.SYM
		ORDER BY SYM ASC),
	TC126 AS
	(SELECT AVG(T.SCLOSE) AS SCLOSE,
			SYM
		FROM T
		WHERE T.RN <= 126
		GROUP BY T.SYM
		ORDER BY SYM ASC),
	TC189 AS
	(SELECT AVG(T.SCLOSE) AS SCLOSE,
			SYM
		FROM T
		WHERE T.RN <= 189
		GROUP BY T.SYM
		ORDER BY SYM ASC),
	RS AS
	(SELECT (2 * TC.SCLOSE / TC62.SCLOSE) + (TC.SCLOSE / TC126.SCLOSE) + (TC.SCLOSE / TC189.SCLOSE) AS STRENGTH,
			TC.SYM,
			TC.SCLOSE AS SCLOSE_S,
			TC62.SCLOSE AS TC62_S,
			TC126.SCLOSE AS TC126_S,
			TC189.SCLOSE AS TC189_S
		FROM TC
		JOIN TC62 ON TC.SYM = TC62.SYM
		JOIN TC126 ON TC.SYM = TC126.SYM
		JOIN TC189 ON TC.SYM = TC189.SYM),
	STR AS
	(SELECT *,
			ROW_NUMBER() OVER (
																						ORDER BY STRENGTH DESC) AS RN,
			COUNT(1) OVER () AS TOTAL
		FROM RS
		ORDER BY STRENGTH DESC), COMPLETERS AS
	(SELECT *,
			100 - (STR.RN * 100 / STR.TOTAL) AS RELATIVE_STRENGTH
		FROM STR)
SELECT *
FROM COMPLETERS;
```

# Delete all stocks with NaN values
```postgres-sql
delete from dayvalues where symbol IN (select distinct symbol from dayvalues where sopen = 'NaN');
```